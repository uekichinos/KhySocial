!function(e){e.fn.khysocial=function(t){var n=e.extend({fontsize:14,boxwidth:200,debug:!1,imgthumb:"left"},t);return this.each(function(){window.thisForm=this,window.fontsize=n.fontsize,window.boxwidth=n.boxwidth,window.debug=n.debug,window.imgthumb=n.imgthumb;var t=[],o=0;if(""!=n.social.twitter&&"undefined"!=typeof n.social.twitter){window.debug===!0&&console.log("[twitter] on");var i=n.social.twitter,r=i.limit,a=i.key,s=i.secretkey,d=i.token,c=i.secrettoken,u=i.query;if(("undefined"==typeof r||""==r||0==r)&&(r=5),"undefined"==typeof a)return window.debug===!0&&console.log("[twitter] missing key"),!1;if(""==a)return window.debug===!0&&console.log("[twitter] key empty"),!1;if("undefined"==typeof s)return window.debug===!0&&console.log("[twitter] missing secret key"),!1;if(""==s)return window.debug===!0&&console.log("[twitter] secret key empty"),!1;if("undefined"==typeof d)return window.debug===!0&&console.log("[twitter] missing token"),!1;if(""==d)return window.debug===!0&&console.log("[twitter] token empty"),!1;if("undefined"==typeof c)return window.debug===!0&&console.log("[twitter] missing secret token"),!1;if(""==c)return window.debug===!0&&console.log("[twitter] secret token empty"),!1;if(""==u)return window.debug===!0&&console.log("[twitter] query empty"),!1;var f,l=u;-1!=l.indexOf("@")?(f="handler",l=l.replace(/@/g,"")):f="hashtag",e.ajax({method:"POST",url:"plugin/tw/index.php",dataType:"json",async:!1,data:{key:a,secretkey:s,token:d,secrettoken:c,limit:r,qtype:f,qstr:l},success:function(i){"hashtag"==f&&(i[0]=i.statuses),e.each(i,function(i,r){e.each(r,function(i,r){var a,s,d,c;e.each(r,function(t,i){1==n.debug&&console.log("[twitter] "+o+") "+t+" : "+i),"text"==t?a=e.fn.convertLink(i):"source"==t?s=i:"created_at"==t&&(d=i),"user"==t&&e.each(i,function(e,t){1==n.debug&&console.log("- "+e+" : "+t),"screen_name"==e&&(c=t),"profile_image_url"==e&&""!=t&&(a="<img src='"+t+"' align='"+window.imgthumb+"'> "+a)})});var u=Date.parse(d)/1e3,f=e.fn.timesince(d);t[o]={text:a,handler:c,timesince:f,timestamp:u,social:"tw"},o++})})}})}if(""!=n.social.facebook&&"undefined"!=typeof n.social.facebook){window.debug===!0&&console.log("[facebook] on");var g=n.social.facebook,w=g.appid,p=g.appsecret,m=g.limit,h=g.query;if(("undefined"==typeof m||""==m||0==m)&&(m=5),"undefined"==typeof w)return window.debug===!0&&console.log("[facebook] missing app id"),!1;if(""==w)return window.debug===!0&&console.log("[facebook] app id empty"),!1;if("undefined"==typeof p)return window.debug===!0&&console.log("[facebook] missing app secret"),!1;if(""==p)return window.debug===!0&&console.log("[facebook] app secret empty"),!1;if("undefined"==typeof h)return window.debug===!0&&console.log("[facebook] missing query"),!1;if(""==h)return window.debug===!0&&console.log("[facebook] query empty"),!1;e.ajax({method:"POST",url:"plugin/fb/index.php",dataType:"json",async:!1,data:{appid:w,appsecret:p,limit:m,query:h},success:function(i){e.each(i,function(i,r){var a,s,d;e.each(r,function(t,i){1==n.debug&&console.log("[facebook] "+o+") "+t+" : "+i),"message"==t?a=e.fn.convertLink(i):"created_time"==t?s=i:"handler"==t?d=i:"picture"==t&&(a="<img src='"+i+"' align='"+window.imgthumb+"'>"+a)});var c=Date.parse(s)/1e3,u=e.fn.timesince(s);t[o]={text:a,handler:d,timesince:u,timestamp:c,social:"fb"},o++})}})}t.sortOn("timestamp"),e.fn.printout(t)})},e.fn.convertLink=function(e){var t=/(https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?)/gi;return e.replace(t,"<a href='$1' target='_blank'>$1</a>")},e.fn.printout=function(t){e.each(t,function(t,n){var o;"tw"==n.social?o="<a href='http://www.twitter.com/"+n.handler+"' target='_blank'>@"+n.handler+"</a>":"fb"==n.social&&(o="<a href='http://www.facebook.com/"+n.handler+"' target='_blank'>"+n.handler+"</a>"),e(thisForm).append("<div id='khysocial-container' style='width:"+boxwidth+";'><div id='khysocial-text' style='font-size:"+fontsize+"px;'>"+n.text+"</div><div id='khysocial-created'>"+o+" "+n.timesince+"<img src='img/"+n.social+"_logo.png' width='15'></div></div>")})},e.fn.timesince=function(t){if(t){t=e.trim(t),t=t.replace(/\.\d\d\d+/,""),t=t.replace(/-/,"/").replace(/-/,"/"),t=t.replace(/T/," ").replace(/Z/," UTC"),t=t.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");var n=new Date(t),o=arguments.length>1?arguments[1]:new Date,i=parseInt((o.getTime()-n)/1e3);i=2>i?2:i;var r="";return r=60>i?i+" seconds ago":120>i?"a minute ago":2700>i?parseInt(i/60,10).toString()+" minutes ago":7200>i?"an hour ago":86400>i?""+parseInt(i/3600,10).toString()+" hours ago":172800>i?"a day ago":parseInt(i/86400,10).toString()+" days ago","posted "+r}},Array.prototype.sortOn=function(e){this.sort(function(t,n){return t[e]>n[e]?-1:t[e]<n[e]?1:0})}}(jQuery);