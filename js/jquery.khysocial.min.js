!function(e){e.fn.khysocial=function(t){var n=e.extend({fontsize:14,debug:!1},t);return this.each(function(){if(window.thisForm=this,window.fontsize=n.fontsize,""!=n.social.twitter&&"undefined"!=typeof n.social.twitter){1==n.debug&&console.log("twitter on");var t=n.social.twitter,i=t.limit,r=t.key,o=t.secretkey,a=t.token,s=t.secrettoken,c=t.query;if(("undefined"==typeof i||""==i||0==i)&&(i=5),"undefined"==typeof r)return 1==n.debug&&console.log("missing twitter key"),!1;if(""==r)return 1==n.debug&&console.log("twitter key empty"),!1;if("undefined"==typeof o)return 1==n.debug&&console.log("missing twitter secret key"),!1;if(""==o)return 1==n.debug&&console.log("twitter secret key empty"),!1;if("undefined"==typeof a)return 1==n.debug&&console.log("missing twitter token"),!1;if(""==a)return 1==n.debug&&console.log("twitter token empty"),!1;if("undefined"==typeof s)return 1==n.debug&&console.log("missing twitter secret token"),!1;if(""==s)return 1==n.debug&&console.log("twitter secret token empty"),!1;if(""==c)return 1==n.debug&&console.log("twitter query empty"),!1;var u,d=c;-1!=d.indexOf("@")?(u="handler",d=d.replace(/@/g,"")):u="hashtag",e.ajax({method:"POST",url:"plugin/tw/index.php",dataType:"json",async:!1,data:{key:r,secretkey:o,token:a,secrettoken:s,limit:i,qtype:u,qstr:d},success:function(t){var i=[];if("hashtag"==u){var r=0;e.each(t.statuses,function(t,o){var a,s,c,u;e.each(o,function(t,i){1==n.debug&&console.log("["+r+"] "+t+" : "+i),"text"==t?a=e.fn.convertLink(i):"source"==t?s=i:"created_at"==t&&(c=i),"user"==t&&e.each(i,function(e,t){1==n.debug&&console.log("- "+e+" : "+t),"screen_name"==e&&(u=t),"profile_image_url"==e&&""!=t&&(a="<img src='"+t+"' align='left'> "+a)})});var d=e.fn.timesince(c);i[r]={tw_text:a,tw_handler:u,timesince:d},r++})}else if("handler"==u){var r=0;e.each(t,function(t,o){e.each(o,function(t,o){var a,s,c,u;e.each(o,function(t,i){1==n.debug&&console.log("["+r+"] "+t+" : "+i),"text"==t?a=e.fn.convertLink(i):"source"==t?s=i:"created_at"==t&&(c=i),"user"==t&&e.each(i,function(e,t){1==n.debug&&console.log("- "+e+" : "+t),"screen_name"==e&&(u=t),"profile_image_url"==e&&""!=t&&(a="<img src='"+t+"' align='left'> "+a)})});var d=Date.parse(c)/1e3,l=e.fn.timesince(c);i[r]={text:a,handler:u,timesince:l,timestamp:d},r++})})}i.sortOn("timestamp"),e.fn.printout(i,"tw")}})}})},e.fn.convertLink=function(e){var t=/(https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?)/gi;return e.replace(t,"<a href='$1' target='_blank'>$1</a>")},e.fn.printout=function(t,n){e.each(t,function(t,i){var r;"tw"==n&&(r="<a href='http://www.twitter.com/"+i.handler+"' target='_blank'>@"+i.handler+"</a>"),e(thisForm).append("<div id='khysocial-container'><div id='khysocial-text' style='font-size:"+fontsize+"px'>"+i.text+"</div><div id='khysocial-created'>"+r+" "+i.timesince+"<img src='img/"+n+"_logo.png' width='15'></div></div>")})},e.fn.timesince=function(t){if(t){t=e.trim(t),t=t.replace(/\.\d\d\d+/,""),t=t.replace(/-/,"/").replace(/-/,"/"),t=t.replace(/T/," ").replace(/Z/," UTC"),t=t.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");var n=new Date(t),i=arguments.length>1?arguments[1]:new Date,r=parseInt((i.getTime()-n)/1e3);r=2>r?2:r;var o="";return o=60>r?r+" seconds ago":120>r?"a minute ago":2700>r?parseInt(r/60,10).toString()+" minutes ago":7200>r?"an hour ago":86400>r?""+parseInt(r/3600,10).toString()+" hours ago":172800>r?"a day ago":parseInt(r/86400,10).toString()+" days ago","posted "+o}},Array.prototype.sortOn=function(e){this.sort(function(t,n){return t[e]>n[e]?-1:t[e]<n[e]?1:0})}}(jQuery);